define(function(require,exports,module){function WifiRepeatModule(){function showConnectStatus(status){var str="",stArr=[_("Disconnect"),_("Bridged Successfully!"),_("Password error!")];status=+status,str=1==status?"text-primary":2==status?"text-success":"text-danger",$("#wifiRelayStatus").attr("class",str).html(stArr[status-1])}function scanWifi(){var list=[];$("#refreshTable").addClass("none"),$("#loading").removeClass("none"),$("#wifiScan").find("table").addClass("none"),$.getJSON("goform/getWifiScan"+getRandom(),function(obj){try{{obj.wifiScan.length}}catch(e){obj.wifiScan=[]}$("#loading").addClass("none"),$("#refreshTable").removeClass("none"),list=reSort(obj.wifiScan),createTable(list),$("#wifiScan").find("table").removeClass("none"),top.mainLogic.initModuleHeight()}),addOverLay(1e3)}function sortNumber(a,b){return a-b}function reSort(arry){var listArry=arry,len=listArry.length,i=0,propArry=[],sortArry=[],newArry=[];for(i=0;len>i;i++)+listArry[i].wifiScanSignalStrength>0&&(listArry[i].wifiScanSignalStrength=0-+listArry[i].wifiScanSignalStrength),propArry.push(listArry[i].wifiScanSignalStrength);for(newArry=propArry.sort(sortNumber),i=0;len>i;i++)for(var j=0;j<listArry.length;j++)if(newArry[i]==listArry[j].wifiScanSignalStrength){sortArry.push(listArry[j]),listArry.splice(j,1);break}return sortArry.reverse()}function createTable(arry){var trElem,tdElem,signal,signalClass,prop,i=0,len=arry.length;if(pageModule.pageRunning){if(0==len)return void $("#wifiScanTbody").html('<tr><td colspan="3" class="text-danger">'+_("SSID Scanning timed out!")+"</td></tr>");for($("#wifiScanTbody").html(""),i=0;len>i;i++){trElem=document.createElement("tr"),tdElem=document.createElement("td"),tdElem.innerHTML="<input type='radio' name='selectSSID' class='selectSSID'>",trElem.appendChild(tdElem);for(prop in arry[i])tdElem=document.createElement("td"),tdElem.className="wifiScanMAC"==prop||"wifiScanChannel"==prop||"wifiScanSecurityMode"==prop?"span-fixed hidden-xs":"span-fixed","wifiScanSignalStrength"!=prop?"undefined"!=typeof tdElem.innerText?tdElem.innerText=arry[i][prop]:tdElem.textContent=arry[i][prop]:(signal=+arry[i][prop],signalClass=signal>-60?"signal_4":-60>=signal&&signal>-70?"signal_3":-70>=signal&&signal>-80?"signal_2":"signal_1",tdElem.innerHTML="<div class='signal "+signalClass+"'><span style='position:relative;left:21px;top:3px;'>"+translatSignal(signal)+"</span></div>"),trElem.appendChild(tdElem);document.getElementById("wifiScanTbody")&&document.getElementById("wifiScanTbody").appendChild(trElem)}}}function translatSignal(percent){var newPer=0;return newPer=percent>=-30?"100%":percent>=-45?Math.round(100-(-30-percent)/1.5)+"%":percent>=-55?90-2*(-45-percent)+"%":percent>=-70?70-2*(-55-percent)+"%":percent>=-85?40-2*(-70-percent)+"%":percent>=95?10-(-85-percent)+"%":"0%"}function showWifiPwd(security){"none"!=security.toLowerCase()?$("#wifiRelayPwdWrap").removeClass("none"):$("#wifiRelayPwdWrap").addClass("none"),top.mainLogic.initModuleHeight()}function changeSSID(){var $parent=$(this).parent().parent(),ssid=$parent.children().eq(1).text(),mac=$parent.children().eq(2).html(),channel=$parent.children().eq(3).html(),security=$parent.children().eq(4).html(),signalStrength=$parent.children().eq(5).find("span").html();+signalStrength.replace(/[%]/,"")<40&&top.mainLogic.showModuleMsg(_("The signal strength of remote wireless network is weak and the wireless bridge may be stopped. Place the router for a better signal.")),$("#wifiRelayPwd").val(""),$("#wifiRelaySSID").html(""==ssid?'<input type="text" maxlength="32" placeholder="'+_("WiFi Name of of the base station")+'" class="form-control validatebox" data-options=\'{"type": "ssid"}\' value='+ssid+">":'<p class="form-control-static">'+ssid+"</p>"),subObj={wifiRelaySSID:ssid,wifiRelayMAC:mac,wifiRelaySecurityMode:security,wifiRelayChannel:channel},showWifiPwd(security),window.scrollTo(0,0),"none"!=security.toLowerCase()&&$("#wifiRelayPwd").focus()}function changeMode(){var securityMode=$("input[name='wifiRelayType']:checked").val()||"ap";"ap"===securityMode?($("#content").hide(),$("#wifiScan").hide()):(scanWifi(),$("#content").show(),$("#wifiScan").show()),top.mainLogic.initModuleHeight()}var subObj={};this.init=function(){this.initEvent()},this.initEvent=function(){$("#refreshTable").on("click",scanWifi),$("#wifiScan").delegate(".selectSSID","click",changeSSID),$("input[name='wifiRelayType']").on("click",changeMode)},this.initValue=function(){var obj=pageModule.data;inputValue(obj),$("#wifiRelaySSID").html('<p class="form-control-static">'+obj.wifiRelaySSID+"</p>"),"true"!=obj.wifiEn&&($("[name='wifiRelayType']")[0].checked=!0,$("[name='wifiRelayType']").attr("disabled",!0)),showConnectStatus(obj.wifiRelayConnectStatus),subObj={wifiRelaySSID:obj.wifiRelaySSID,wifiRelayMAC:obj.wifiRelayMAC,wifiRelaySecurityMode:obj.wifiRelaySecurityMode,wifiRelayChannel:obj.wifiRelayChannel},changeMode(),showWifiPwd(obj.wifiRelaySecurityMode)},this.checkData=function(){var workMode=$("input[name='wifiRelayType']:checked").val()||"ap",wifiPwd=$("#wifiRelayPwd").val(),ssid=$("#wifiRelaySSID").children(0).val()||$("#wifiRelaySSID").children(0).text();if(!ssid&&"ap"!=workMode)return _("Please select a WiFi name.");if("ap"!=workMode&&!$.isHidden($("#wifiRelayPwd")[0])){if(""==wifiPwd)return $("#wifiRelayPwd").focus(),_("The password of base station router must contain 8~63 ASCII, or 64 HEX.");if(!/^[0-9a-fA-F]{8,64}$/.test(wifiPwd)&&!/^[ -~]{8,63}$/.test(wifiPwd))return $("#wifiRelayPwd").focus(),_("The password of base station router must contain 8~63 ASCII, or 64 HEX.")}},this.getSubmitData=function(){var ssid=$("#wifiRelaySSID").children(0).val();return ssid&&(subObj.wifiRelaySSID=$("#wifiRelaySSID").children().val()),subObj.wifiRelayPwd=$("#wifiRelayPwd").val(),subObj.wifiRelayType=$("input[name='wifiRelayType']:checked").val(),objToString(subObj)}}var pageModule=new PageLogic("goform/getWifiRelay","goform/setWifiRelay");pageModule.modules=[],pageModule.rebootIP=location.host,module.exports=pageModule;var wifiRepeatModule=new WifiRepeatModule;pageModule.modules.push(wifiRepeatModule),pageModule.beforeSubmit=function(){return"ap"==pageModule.data.wifiRelayType&&"ap"==$("input[name='wifiRelayType']:checked").val()?!0:confirm(_("The Router will reboot to activate the settings."))?!0:!1}});