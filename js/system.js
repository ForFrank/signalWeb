define(function(require,exports,module){function LoginPwdModule(){this.init=function(){this.addInputEvent=!1},this.initValue=function(){var obj=pageModule.data;"true"==obj.firmware.hasPwd?$("#oldPwdWrap").show():$("#oldPwdWrap").hide(),$("#oldPwd").val(""),this.addInputEvent||($("#oldPwd").initPassword(_("Must be numbers and letters"),!0),$("#newPwd").initPassword(_("Must be numbers and letters"),!0),$("#cfmPwd").initPassword(_("Repeat New Password"),!0),this.addInputEvent=!0)},this.checkData=function(){return $("#newPwd").val()!=$("#cfmPwd").val()?($("#cfmPwd_")&&$("#cfmPwd_").length>0?$.isHidden($("#cfmPwd_")[0])?$("#cfmPwd").focus():$("#cfmPwd_").focus():$("#cfmPwd").focus(),_("Password mismatch!")):void 0},this.getSubmitData=function(){var encode=new Encode,data={newPwd:encode($("#newPwd").val())};return"true"==pageModule.data.firmware.hasPwd&&(data.oldPwd=encode($("#oldPwd").val())),objToString(data)}}function WanParamModule(){function initMacOption(obj){var wanMac=obj.macCurrentWan,hostMac=obj.macHost;"true"==obj.macMobileDevice&&$("#macClone option[value='clone']").remove(),"clone"==obj.macClone&&wanMac!=hostMac&&(obj.macClone="manual")}function changeMacCloneType(){var macCloneType=$("#macClone").val();"clone"==macCloneType?($("#macCurrenWrap").html(_("Local Host's MAC: %s",[hostMac])),$("#macCurrentWan").hide(),$("#macCurrenWrap").show()):"default"==macCloneType?($("#macCurrenWrap").html(_("Factory MAC: %s",[routerMac])),$("#macCurrentWan").hide(),$("#macCurrenWrap").show()):($("#macCurrentWan").show(),$("#macCurrenWrap").hide()),top.mainLogic.initModuleHeight()}function changeServerType(){var wanServerType=$("#wanServerType").val();$("#wanServerName").removeValidateTipError(!0),$("#wanServerTip, #wanServerName").addClass("none"),"default"==wanServerType?$("#wanServerTip").removeClass("none"):$("#wanServerName").removeClass("none")}function changeServiceType(){$("#wanServiceName").removeValidateTipError(!0);var wanServiceType=$("#wanServiceType").val();$("#wanServiceTip, #wanServiceName").addClass("none"),"default"==wanServiceType?$("#wanServiceTip").removeClass("none"):$("#wanServiceName").removeClass("none")}function setWanValue(obj){$("#wanSpeed").val(obj.wanSpeed),$("#wanMTUCurrent").html(obj.wanMTUCurrent),$("#wanSpeedCurrent").html($("#wanSpeed").find("option[value='"+obj.wanSpeedCurrent+"']").html()),$("#wanServerType").val(""==obj.wanServerName?"default":"manual"),$("#wanServiceType").val(""==obj.wanServiceName?"default":"manual"),$("#wanServerName").val(obj.wanServerName),$("#wanServiceName").val(obj.wanServiceName)}this.init=function(){this.addInputEvent=!1,this.initEvent()},this.initEvent=function(){$("#macClone").on("change",changeMacCloneType),$("#wanServerType").on("change",changeServerType),$("#wanServiceType").on("change",changeServiceType)},this.initValue=function(){var obj=pageModule.data;this.initHtml(obj.wan),setWanValue(obj.wan),this.addInputEvent||($("#wanServerName").addPlaceholder(_("Default")),$("#wanServiceName").addPlaceholder(_("Default")),this.addInputEvent=!0),routerMac=obj.mac.macRouter,hostMac=obj.mac.macHost,initMacOption(obj.mac),inputValue(obj.mac),changeMacCloneType(),changeServerType(),changeServiceType()},this.getSubmitData=function(){var wanServerName,wanServiceName,wanMac="";wanMac="clone"==$("#macClone").val()?hostMac:"default"==$("#macClone").val()?routerMac:$("#macCurrentWan").val().replace(/[-]/g,":"),wanServerName="manual"==$("#wanServerType").val()?$("#wanServerName").val():"",wanServiceName="manual"==$("#wanServiceType").val()?$("#wanServiceName").val():"";var data={wanServerName:wanServerName,wanServiceName:wanServiceName,wanMTU:$("#wanMTU")[0].val(),macClone:$("#macClone").val(),wanMAC:wanMac.toUpperCase(),wanSpeed:$("#wanSpeed").val()};return objToString(data)},this.initHtml=function(obj){"pppoe"==obj.wanType?($("#serverNameWrap").show(),$("#wanMTU").attr("data-options",'{"type":"num", "args":[576, 1492]}')):($("#serverNameWrap").hide(),$("#wanMTU").attr("data-options",'{"type":"num", "args":[576, 1500]}')),$("#wanMTU").toSelect({initVal:obj.wanMTU,editable:"1",size:"small",options:[{1492:"1492",1480:"1480",1450:"1450",1400:"1400",".divider":".divider",".hand-set":_("Manual")}]})};var hostMac,routerMac}function LanModule(){function changeIpNet(){var ipCheck=!1,lanIP=$("#lanIP").val();if(/^([1-9]|[1-9]\d|1\d\d|2[0-1]\d|22[0-3])\.(([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.){2}([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/.test(lanIP)&&(ipCheck=!0),!$("#lanMask").parent().hasClass("has-error")&&!$("#lanIP").parent().hasClass("has-error")&&ipCheck){if(!$("#lanIP").parent().hasClass("has-error")&&ipCheck){var ipNet="",ipArry=$("#lanIP").val().split(".");ipNet=ipArry[0]+"."+ipArry[1]+"."+ipArry[2]+".",$(".ipNet").html(ipNet)}pageModule.data.lan.lanIP==pageModule.data.lan.lanDns1&&$("#lanDns1").val($("#lanIP").val())}}function changeDhcpEn(){$("#dhcpEn")[0].checked?$("#dnsWrap").show():$("#dnsWrap").hide(),top.mainLogic.initModuleHeight()}this.init=function(){this.initEvent()},this.initEvent=function(){$("#dhcpEn").on("click",changeDhcpEn),$("#lanIP").on("blur",changeIpNet),$.validate.valid.lanMaskExt={all:function(str){var msg=$.validate.valid.mask(str);return msg?msg:"255.255.255.0"!==str&&"255.255.0.0"!==str&&"255.0.0.0"!==str?_("不支持变长子网掩码"):void 0}}},this.initValue=function(){var obj=pageModule.data;inputValue(obj.lan);var ipNet="",ipArry=obj.lan.lanDhcpStartIP.split(".");ipNet=ipArry[0]+"."+ipArry[1]+"."+ipArry[2]+".",$(".ipNet").html(ipNet),$("#lanDhcpStartIP").val(obj.lan.lanDhcpStartIP.split(".")[3]),$("#lanDhcpEndIP").val(obj.lan.lanDhcpEndIP.split(".")[3]),changeDhcpEn()},this.checkData=function(){var lanIP=$("#lanIP").val(),lanMask=$("#lanMask").val(),startIP=$(".ipNet").eq(0).html()+$("#lanDhcpStartIP").val(),endIP=$(".ipNet").eq(0).html()+$("#lanDhcpEndIP").val(),wanIP=pageModule.data.wan.wanIP||"0.0.0.0",wanMask=pageModule.data.wan.wanMask||"0.0.0.0",msg=checkIsVoildIpMask(lanIP,lanMask,_("LAN IP"));if(msg)return $("#lanIP").focus(),msg;if(/^([1-9]|[1-9]\d|1\d\d|2[0-1]\d|22[0-3])\.(([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.){2}([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/.test(wanIP)&&checkIpInSameSegment(lanIP,lanMask,wanIP,wanMask))return $("#lanIP").focus(),_("%s and %s (%s) should not be in the same network segment.",[_("LAN IP"),_("WAN IP"),wanIP]);if("255.255.255.0"!==lanMask&&"255.255.0.0"!==lanMask&&"255.0.0.0"!==lanMask)return _("子网掩码有误！不支持可变长子网掩码");if($("#dhcpEn")[0].checked){if(!checkIpInSameSegment(startIP,lanMask,lanIP,lanMask))return $("#lanDhcpStartIP").focus(),_("%s and %s must be in the same network segment.",[_("Start IP"),_("LAN IP")]);if(msg=checkIsVoildIpMask(startIP,lanMask,_("Start IP")))return $("#lanDhcpStartIP").focus(),msg;if(!checkIpInSameSegment(endIP,lanMask,lanIP,lanMask))return $("#lanDhcpEndIP").focus(),_("%s and %s must be in the same network segment.",[_("End IP"),_("LAN IP")]);if(msg=checkIsVoildIpMask(endIP,lanMask,_("End IP")))return $("#lanDhcpEndIP").focus(),msg;var sipNumber,eipNumber,sipArry=startIP.split("."),eipArry=endIP.split(".");if(sipNumber=256*parseInt(sipArry[0],10)*256*256+256*parseInt(sipArry[1],10)*256+256*parseInt(sipArry[2],10)+parseInt(sipArry[3],10),eipNumber=256*parseInt(eipArry[0],10)*256*256+256*parseInt(eipArry[1],10)*256+256*parseInt(eipArry[2],10)+parseInt(eipArry[3],10),sipNumber>eipNumber)return $("#lanDhcpEndIP").focus(),_("The start IP can't be greater than the end IP.");if($("#lanDns1").val()==$("#lanDns2").val())return _("Preferred DNS server and Alternative DNS server can't be the same.")}},this.getSubmitData=function(){var data={lanIP:$("#lanIP").val(),lanMask:$("#lanMask").val(),dhcpEn:1==$("#dhcpEn")[0].checked?"true":"false",lanDhcpStartIP:$(".ipNet").eq(0).html()+$("#lanDhcpStartIP").val(),lanDhcpEndIP:$(".ipNet").eq(0).html()+$("#lanDhcpEndIP").val(),lanDns1:$("#lanDns1").val(),lanDns2:$("#lanDns2").val()};return objToString(data)}}function ManageModule(){function goUpgrade(){pageModule.upgradeLoad=new AjaxUpload("upgrade",{action:"./cgi-bin/upgrade",name:"upgradeFile",responseType:"json",onSubmit:function(file,ext){return confirm(_("Upgrade the device?"))?ext?void 0:!1:(document.upgradefrm.reset(),!1)},onComplete:function(file,msg){if("string"==typeof msg&&checkIsTimeOut(msg))return void top.location.reload(!0);var num=msg.errCode;"100"==num?parent.progressLogic.init("","upgrade"):"201"==num?(mainLogic.showModuleMsg(_("Firmware error!")+" "+_("The router will reboot.")),setTimeout(function(){progressLogic.init("","reboot",200)},2e3),clearTimeout(pageModule.updateTimer)):"202"==num?mainLogic.showModuleMsg(_("Upgrade failed!")):"203"==num&&(mainLogic.showModuleMsg(_("Firmware size is too large!")+" "+_("The router will reboot.")),setTimeout(function(){progressLogic.init("","reboot",200)},2e3),clearTimeout(pageModule.updateTimer))}})}function goInport(){pageModule.inport=new AjaxUpload("inport",{action:"./cgi-bin/UploadCfg",name:"inportFile",responseType:"json",onSubmit:function(file,ext){return confirm(_("Restore now?"))?ext?void 0:!1:(document.inportfrm.reset(),!1)},onComplete:function(file,msg){if("string"==typeof msg&&checkIsTimeOut(msg))return void top.location.reload(!0);var num=msg.errCode;"100"==num?progressLogic.init("","reboot",200):"201"==num?(mainLogic.showModuleMsg(_("Firmware error!")+" "+_("The router will reboot.")),setTimeout(function(){progressLogic.init("","reboot",200)},2e3)):"202"==num&&(mainLogic.showModuleMsg(_("导入配置失败!")),setTimeout(function(){progressLogic.init("","reboot",200)},2e3)),clearTimeout(pageModule.updateTimer)}})}this.init=function(){this.initEvent(),goUpgrade(),goInport()},this.initEvent=function(){$("#reboot").on("click",function(){confirm(_("Reboot the device?"))&&$.post("goform/sysReboot","action=reboot",function(str){if(checkIsTimeOut(str))return void top.location.reload(!0);var num=$.parseJSON(str).errCode;100==num&&(progressLogic.init("","reboot",200),clearTimeout(pageModule.updateTimer))})}),$("#restore").on("click",function(){confirm(_("Resetting to factory default will clear all settings of the router."))&&$.post("goform/sysRestore","action=restore",function(str){if(checkIsTimeOut(str))return void top.location.reload(!0);var num=$.parseJSON(str).errCode;if(100==num){var jumpIp=-1==window.location.href.indexOf("tendawifi")?"192.168.0.1":"";progressLogic.init(_("Resetting...Please wait..."),"restore",200,jumpIp),clearTimeout(pageModule.updateTimer)}})}),$("#export").on("click",function(){window.location="/cgi-bin/DownloadSyslog/RouterSystem.log?"+Math.random()}),$("#exportConfig").on("click",function(){window.location="/cgi-bin/DownloadCfg/RouterCfm.cfg?"+Math.random()})},this.initValue=function(){var obj=pageModule.data.firmware;$("#firmwareAutoMaintenanceEn")[0].checked="true"==obj.firmwareAutoMaintenanceEn,$("#firmwareVision").html(obj.firmwareVision)},this.checkData=function(){},this.getSubmitData=function(){pageModule.rebootIP=$("#lanIP").val();var data={firmwareAutoMaintenanceEn:1==$("#firmwareAutoMaintenanceEn")[0].checked?"true":"false"};return objToString(data)}}var pageModule=new PageLogic("goform/getSysTools","goform/setSystem");pageModule.modules=[],pageModule.beforeSubmit=function(){return pageModule.data.lan.lanIP==$("#lanIP").val()||confirm(_("The login IP will be changed into %s.",[$("#lanIP").val()]))?!0:!1},module.exports=pageModule;var loginPwdModule=new LoginPwdModule;pageModule.modules.push(loginPwdModule);var wanParamModule=new WanParamModule;pageModule.modules.push(wanParamModule);var lanModule=new LanModule;pageModule.modules.push(lanModule);var manageModule=new ManageModule;pageModule.modules.push(manageModule)});